<script>
        // Use a global variable to keep track of the last known conversation ID
        let lastConversationId = null;

        // Function to fetch new calls from the server
        async function fetchNewCalls() {
            try {
                const url = `/api/webhook/calls?last_id=${lastConversationId}`;
                const response = await fetch(url);
                const data = await response.json();

                if (data.success && data.new_calls.length > 0) {
                    // Update the last known ID
                    lastConversationId = data.new_calls[0].conversation_id;

                    // Group new calls by conversation ID
                    const newGroupedCalls = {};
                    data.new_calls.forEach(call => {
                        if (!newGroupedCalls[call.conversation_id]) {
                            newGroupedCalls[call.conversation_id] = [];
                        }
                        newGroupedCalls[call.conversation_id].push(call);
                    });

                    // Update the HTML
                    const callsSection = document.querySelector('.calls-section');
                    let newHtml = '';
                    for (const convId in newGroupedCalls) {
                        const calls = newGroupedCalls[convId];
                        // Render a new conversation group and table
                        newHtml += `
                            <div class="conversation-group">
                                <div class="conversation-header">
                                    Conversation ID: ${convId}
                                </div>
                                <table class="calls-table">
                                    <thead>
                                        ... (table headers) ...
                                    </thead>
                                    <tbody>
                                        ${calls.map(call => `
                                            <tr>
                                                <td>${call.timestamp.slice(0, 19)}</td>
                                                <td>${call.call_type || 'Customer Call'}</td>
                                                <td>${call.customer_phone || call.to_number || 'N/A'}</td>
                                                <td>${call.duration || 0}s</td>
                                                <td><span class="call-status status-${call.status || 'completed'}">${(call.status || 'completed').title()}</span></td>
                                                <td>... (details) ...</td>
                                            </tr>
                                        `).join('')}
                                    </tbody>
                                </table>
                            </div>
                        `;
                    }
                    callsSection.insertAdjacentHTML('beforeend', newHtml);
                }
            } catch (error) {
                console.error("Failed to fetch new calls:", error);
            }
        }

        // Fetch new calls every 5 seconds
        setInterval(fetchNewCalls, 5000);
    </script>
